<header>
    <h1>Base64/文件 转换</h1>

</header>
<main>
    <form id="fileConverterForm">
        <label for="mode">模式:</label>
        <select id="mode" required>
            <option value="fileToBase64">文件到 Base64</option>
            <option value="base64ToFile">Base64 到文件</option>
        </select>
        <label for="data">输入数据:</label>
        <textarea id="data" placeholder="仅在Base64到文件模式下使用"></textarea>
        <label for="fileInput">选择文件:</label>
        <input type="file" id="fileInput" accept="*/*">
        <button type="submit">转换</button>
    </form>
    <div id="result"></div>
</main>
<script>
    document.getElementById('fileConverterForm').addEventListener('submit', async function(event) {
        event.preventDefault();
        const mode = document.getElementById('mode').value;
        const data = document.getElementById('data').value;
        const fileInput = document.getElementById('fileInput').files[0];
        const resultDiv = document.getElementById('result');
        
        try {
            if (mode === 'fileToBase64') {
                const reader = new FileReader();
                reader.onloadend = () => {
                    const base64String = reader.result.split(',')[1];
                    resultDiv.textContent = `Base64 数据: ${base64String}`;
                    resultDiv.style.color = 'green';
                };
                reader.readAsDataURL(fileInput);
            } else if (mode === 'base64ToFile') {
                const byteCharacters = atob(data);
                const byteNumbers = new Array(byteCharacters.length);
                for (let i = 0; i < byteCharacters.length; i++) {
                    byteNumbers[i] = byteCharacters.charCodeAt(i);
                }
                const byteArray = new Uint8Array(byteNumbers);
                const blob = new Blob([byteArray], { type: 'application/octet-stream' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = 'downloaded_file.bin';
                document.body.appendChild(a);
                a.click();
                a.remove();
                URL.revokeObjectURL(url);
                resultDiv.textContent = `文件已下载`;
                resultDiv.style.color = 'green';
            }
        } catch (error) {
            resultDiv.textContent = `错误: ${error.message}`;
            resultDiv.style.color = 'red';
        }
    });
</script>